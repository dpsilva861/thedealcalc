{% extends "base.html" %}
{% block title %}Dashboard â€” File Organizer{% endblock %}
{% block content %}
<h1>Dashboard</h1>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-number">{{ "{:,}".format(stats.total_files) }}</div>
        <div class="stat-label">Total Files</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ "%.1f"|format(stats.total_size / 1073741824) }} GB</div>
        <div class="stat-label">Total Size</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ review_files|length }}</div>
        <div class="stat-label">Awaiting Review</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ stats.by_category|length }}</div>
        <div class="stat-label">Categories</div>
    </div>
</div>

<div class="grid-2col">
    <div class="card">
        <h2>Files by Category</h2>
        <table class="data-table">
            <thead><tr><th>Category</th><th>Count</th></tr></thead>
            <tbody>
            {% for cat, count in stats.by_category.items() %}
            <tr>
                <td><a href="{{ url_for('browse', view='category', selected=cat) }}">{{ cat }}</a></td>
                <td>{{ "{:,}".format(count) }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="card">
        <h2>Top Extensions</h2>
        <table class="data-table">
            <thead><tr><th>Extension</th><th>Count</th></tr></thead>
            <tbody>
            {% for ext, count in stats.by_extension.items() %}
            <tr>
                <td>.{{ ext }}</td>
                <td>{{ "{:,}".format(count) }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="card">
    <h2>Top Tags</h2>
    <div class="tag-cloud">
        {% for tag, count in tags %}
        <a href="{{ url_for('browse', view='tags', selected=tag) }}" class="tag">{{ tag }} ({{ count }})</a>
        {% endfor %}
    </div>
</div>

<div class="card">
    <h2>Recent Files</h2>
    <table class="data-table">
        <thead>
            <tr><th>Filename</th><th>Category</th><th>Type</th><th>Tags</th><th>Scanned</th><th></th></tr>
        </thead>
        <tbody>
        {% for f in recent %}
        <tr>
            <td class="filename" title="{{ f.file_path }}">{{ f.filename }}</td>
            <td>{{ f.category }}</td>
            <td>{{ f.document_type }}</td>
            <td>
                {% for tag in f.tags[:3] %}
                <span class="tag-small">{{ tag }}</span>
                {% endfor %}
            </td>
            <td>{{ f.scanned_at[:10] }}</td>
            <td><button onclick="openFile({{ f.id }})" class="btn-small">Open</button></td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{% if accuracy %}
<div class="card">
    <h2>Agent Accuracy (Last 30 Days)</h2>
    <table class="data-table">
        <thead><tr><th>Date</th><th>Processed</th><th>Correct</th><th>Corrected</th><th>Accuracy</th></tr></thead>
        <tbody>
        {% for a in accuracy %}
        <tr>
            <td>{{ a.date }}</td>
            <td>{{ a.files_processed }}</td>
            <td>{{ a.files_correct }}</td>
            <td>{{ a.files_corrected }}</td>
            <td>{{ "%.1f"|format(a.accuracy) }}%</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}
